# انتقال داده‌ها از فایل

## مقدمه

این ابزار امکان انتقال داده‌های موجود در فایل‌های مختلف (CSV، JSON، TXT) را به پلاگین باشگاه استیل البرز فراهم می‌کند. این ابزار به صورت خودکار کاربران جدید ایجاد کرده و سریال‌های محصول را به عنوان درخواست پاداش ثبت می‌کند.

## پیش‌نیازها

- دسترسی مدیریت در وردپرس
- فایل حاوی داده‌ها در یکی از فرمت‌های مجاز

## نحوه استفاده

### 1. دسترسی به ابزار انتقال

1. به پنل مدیریت وردپرس بروید
2. از منوی "باشگاه استیل البرز" گزینه "انتقال داده‌ها" را انتخاب کنید
3. وضعیت آپلود فایل و محدودیت‌ها را بررسی کنید

### 2. فرمت‌های فایل مجاز

#### CSV
فایل CSV با ستون‌های زیر:
```
نام مشتری,کد ملی,شماره موبایل,آدرس,سریال محصول,گروه محصول,نام کاربری
احمد محمدی,1234567890,09123456789,تهران، خیابان ولیعصر,ABC123,اجاق گاز,09123456789
```

#### JSON
آرایه‌ای از آبجکت‌ها:
```json
[
  {
    "customer_name": "احمد محمدی",
    "customer_national_id": "1234567890",
    "customer_phone": "09123456789",
    "customer_address": "تهران، خیابان ولیعصر",
    "product_serial": "ABC123",
    "product_group": "اجاق گاز",
    "username": "09123456789"
  }
]
```

#### TXT
فایل متنی با جداکننده tab یا کاما:
```
احمد محمدی	1234567890	09123456789	تهران، خیابان ولیعصر	ABC123	اجاق گاز	09123456789
```

### 3. شروع انتقال

1. فایل حاوی داده‌ها را انتخاب کنید
2. روی دکمه "شروع انتقال داده‌ها" کلیک کنید
3. تأیید کنید که می‌خواهید انتقال را شروع کنید
4. منتظر بمانید تا فرآیند انتقال کامل شود
5. نتایج انتقال را بررسی کنید

## نحوه کارکرد

### 1. خواندن داده‌ها
- فایل آپلود شده بر اساس نوع آن پردازش می‌شود
- داده‌های معتبر استخراج می‌شود
- خطاهای فرمت فایل گزارش می‌شود

### 2. ایجاد کاربران
- بر اساس شماره موبایل، کاربران موجود بررسی می‌شوند
- اگر کاربری با شماره موبایل موجود نباشد، کاربر جدید ایجاد می‌شود
- نقش کاربر به صورت "representative" تنظیم می‌شود
- کیف پول و حساب امتیاز برای کاربر جدید ایجاد می‌شود

### 3. ثبت درخواست‌های پاداش
- سریال‌های محصول به عنوان درخواست پاداش ثبت می‌شوند
- مبلغ پاداش بر اساس گروه محصول محاسبه می‌شود:
  - اجاق گاز: 50,000 تومان
  - آبگرمکن: 30,000 تومان
  - یخچال: 40,000 تومان
  - ماشین لباسشویی: 35,000 تومان
  - ماشین ظرفشویی: 45,000 تومان
  - سایر: 25,000 تومان

### 4. مدیریت خطاها
- سریال‌های تکراری نادیده گرفته می‌شوند
- رکوردهای بدون سریال یا شماره موبایل رد می‌شوند
- خطاهای ایجاد کاربر ثبت و گزارش می‌شوند

## نتایج انتقال

پس از اتمام انتقال، نتایج زیر نمایش داده می‌شود:

- **کل رکوردها**: تعداد کل رکوردهای موجود در فایل
- **موفق**: تعداد رکوردهایی که با موفقیت منتقل شدند
- **ناموفق**: تعداد رکوردهایی که با خطا مواجه شدند
- **خطاها**: لیست خطاهای رخ داده

## نکات مهم

### 1. امنیت
- انتقال فقط از طریق پنل مدیریت امکان‌پذیر است
- از Nonce برای امنیت استفاده می‌شود
- تمام ورودی‌ها sanitize می‌شوند
- فایل‌های آپلود شده بررسی می‌شوند

### 2. عملکرد
- انتقال به صورت AJAX انجام می‌شود
- برای فایل‌های بزرگ، ممکن است زمان زیادی طول بکشد
- حداکثر حجم فایل: 5 مگابایت
- پیشنهاد می‌شود ابتدا روی تعداد کمی رکورد تست کنید

### 3. پشتیبان‌گیری
- قبل از انتقال، از دیتابیس پشتیبان تهیه کنید
- داده‌های موجود در پلاگین حفظ می‌شوند
- فقط رکوردهای جدید اضافه می‌شوند

### 4. فرمت فایل
- فایل‌های CSV باید با کاما جدا شوند
- فایل‌های JSON باید آرایه‌ای از آبجکت‌ها باشند
- فایل‌های TXT می‌توانند با tab یا کاما جدا شوند

## عیب‌یابی

### مشکل: فایل آپلود نمی‌شود
**راه‌حل**: حجم فایل را بررسی کنید (حداکثر 5 مگابایت)

### مشکل: نوع فایل پشتیبانی نمی‌شود
**راه‌حل**: فقط فایل‌های CSV، JSON و TXT مجاز هستند

### مشکل: داده‌ها درست خوانده نمی‌شوند
**راه‌حل**: فرمت فایل را بررسی کنید و مطمئن شوید که ستون‌ها درست هستند

### مشکل: خطای ایجاد کاربر
**راه‌حل**: شماره موبایل را بررسی کنید و مطمئن شوید که فرمت صحیح دارد

## پشتیبانی

برای مشکلات و سوالات مربوط به انتقال داده‌ها، با تیم توسعه استیل البرز تماس بگیرید. 