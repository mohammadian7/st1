# فرم بهبود یافته ثبت سریال - باشگاه نمایندگان استیل البرز

## ویژگی‌های جدید

### 1. طراحی ساده و کاربرپسند
- **اطلاعات فروشگاه:** نمایش کد فروشگاه (نام کاربری نماینده)
- **اطلاعات نماینده:** نمایش نام و نام خانوادگی نماینده
- **اطلاعات محصول:** انتخاب گروه محصول و ثبت سریال
- **اطلاعات خریدار:** نام، کد ملی، موبایل و آدرس

### 2. ثبت سریال واحد
- **فیلد سریال واحد:** ثبت یک سریال در هر بار
- **طراحی دو ستونی:** چیدمان بهینه فیلدها
- **اعتبارسنجی:** سریال محصول الزامی است

### 3. حفظ اطلاعات مشتری
- **حفظ خودکار:** اطلاعات مشتری پس از ثبت موفق حفظ می‌شود
- **پاک شدن فیلدهای محصول:** فقط فیلدهای محصول پس از ثبت پاک می‌شوند
- **ثبت‌های متعدد:** امکان ثبت چندین سریال برای یک مشتری

### 4. بررسی سریال
- **بررسی سریال:** بررسی سریال با API سروشان
- **نمایش نتیجه:** نتیجه بررسی در کنار فرم نمایش داده می‌شود
- **پیام‌های واضح:** نمایش پیام‌های موفقیت و خطا

### 5. گروه‌های محصول
- **اجاق گاز:** محصولات آشپزخانه
- **آبگرمکن:** سیستم‌های گرمایشی
- **یخچال:** لوازم سرمایشی
- **ماشین لباسشویی:** لوازم شستشو
- **ماشین ظرفشویی:** لوازم آشپزخانه
- **سایر:** محصولات دیگر

## نحوه استفاده

### 1. نصب و فعال‌سازی
```php
// شورت‌کد در صفحه یا پست
[steelalborz_reward_form]
```

### 2. پر کردن فرم
1. **اطلاعات فروشگاه و نماینده:** به صورت خودکار پر می‌شود
2. **انتخاب گروه محصول:** از منوی کشویی انتخاب کنید
3. **ثبت سریال:** سریال محصول را وارد کنید
4. **اطلاعات مشتری:** نام، کد ملی، موبایل و آدرس
5. **بررسی سریال:** روی دکمه "بررسی سریال" کلیک کنید
6. **ثبت درخواست:** روی "ثبت درخواست پاداش" کلیک کنید

### 3. عملیات‌های اضافی
- **پاک کردن فیلدها:** برای شروع مجدد
- **حفظ اطلاعات مشتری:** به صورت خودکار پس از ثبت موفق

## تغییرات در دیتابیس

### جدول `steelalborz_installation_rewards`
```sql
ALTER TABLE wp_steelalborz_installation_rewards 
ADD COLUMN product_group VARCHAR(100) DEFAULT NULL 
AFTER product_serial;
```

## تغییرات در کد

### 1. فایل `includes/class-shortcodes.php`
- بهبود فرم HTML با طراحی دو ستونی
- حذف فیلدهای تکرار شونده
- حذف دکمه‌های اضافه/حذف
- حذف دکمه ذخیره اطلاعات مشتری

### 2. فایل `includes/class-steelalborz-club.php`
- بهبود AJAX handler برای پردازش سریال واحد
- اعتبارسنجی فیلدهای جدید
- مدیریت خطاها

### 3. فایل `assets/css/frontend.css`
- استایل‌های جدید برای فرم ساده
- طراحی دو ستونی
- حذف استایل‌های مربوط به دکمه‌های حذف شده

### 4. فایل `assets/js/frontend.js`
- JavaScript برای تعامل با فرم ساده
- حفظ اطلاعات مشتری پس از ثبت موفق
- پاک کردن فقط فیلدهای محصول

## امنیت

### 1. اعتبارسنجی
- بررسی نقش کاربر
- اعتبارسنجی فیلدهای اجباری
- بررسی تکراری نبودن سریال

### 2. Sanitization
- پاکسازی تمام ورودی‌ها
- استفاده از prepared statements
- محافظت در برابر XSS

### 3. Nonce Verification
- بررسی nonce برای تمام درخواست‌های AJAX
- محافظت در برابر CSRF

## نکات مهم

### 1. عملکرد
- فرم پس از ثبت موفق، فقط فیلدهای محصول پاک می‌شود
- اطلاعات مشتری حفظ می‌شود
- امکان ثبت چندین سریال برای یک مشتری
- نمایش پیام‌های موفقیت و خطا

### 2. تجربه کاربری
- طراحی دو ستونی برای استفاده بهتر از فضا
- طراحی responsive برای موبایل
- پیام‌های واضح و کاربرپسند
- سادگی در استفاده

### 3. سازگاری
- سازگار با تمام مرورگرهای مدرن
- پشتیبانی از JavaScript
- طراحی RTL برای فارسی

## عیب‌یابی

### مشکلات رایج
1. **خطای بررسی سریال:** اتصال به API سروشان را بررسی کنید
2. **خطای ثبت:** دسترسی دیتابیس را بررسی کنید
3. **عدم نمایش فرم:** نقش کاربر را بررسی کنید

### راه‌حل‌ها
1. **بررسی تنظیمات API:** در پنل مدیریت
2. **بررسی دسترسی‌ها:** نقش‌های کاربری
3. **بررسی خطاها:** در console مرورگر

## تغییرات در نسخه 1.0.3

- ساده‌سازی فرم ثبت سریال
- حذف فیلدهای تکرار شونده
- حذف دکمه‌های اضافه/حذف
- حذف دکمه ذخیره اطلاعات مشتری
- طراحی دو ستونی
- حفظ خودکار اطلاعات مشتری
- بهبود تجربه کاربری
- بهبود امنیت و اعتبارسنجی 